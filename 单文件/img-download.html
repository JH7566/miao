<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>图片下载</title>
</head>

<body>

  <button>下载图片</button>
  <script>


    // get请求
    function get(url, callback) {
      var req = new XMLHttpRequest();
      req.open("GET", url, true);
      req.send();
      req.addEventListener("load", () => {
        callback(req.responseText);
      });
    }

    var button = document.querySelector("button");
    var pic = [];
    var picJSON;

    // 请求json
    get("https://xieranmaya.github.io/images/cats/cats.json", (data) => {
      picJSON = JSON.parse(data);
      pic = picJSON.map((it, idx) => it.fullUrl);
    });

    button.addEventListener("click", () => {
      if (pic.length === 0) {
        pic = picJSON.map((it, idx) => it.fullUrl);
      }

      // 从数组的开头获取下一张图片
      const nextPic = pic.shift();
      if (nextPic) {
        get(nextPic, nextOne);
      }
    });

    // 递归回调函数
    function nextOne(data) {
      const nextPic = pic.shift();
      if (nextPic) {
        get(nextPic, nextOne);
      }
    }


  </script>
</body>

</html>
