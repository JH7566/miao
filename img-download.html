<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>图片下载</title>
</head>

<body>

  <button>下载图片</button>
  <script>

    var button = document.querySelector("button")
    var pic
    var picJSON

    //请求json
    get("https://xieranmaya.github.io/images/cats/cats.json", (data) => {
      picJSON = JSON.parse(data)
      pic = picJSON.map((it, idx) => it.fullUrl)
    })

    button.addEventListener("click", () => {
      if (pic.length === 0) {
        pic = picJSON.map((it, idx) => it.fullUrl)
      }


      //从数组的开头获取下一张图片
      const nextpic = pic.shift();
      if (nextpic) {
        get(nextpic, callb);
      }
    })

    // 递归回调函数
    function callb(data) {
      const nextpic = pic.shift();
      if (nextpic) {
        get(nextpic, callb);
      }
    }

    // get请求
    function get(url, callback) {
      var request = new XMLHttpRequest();
      request.open("GET", url, true);
      request.send();
      request.addEventListener("load", () => {
        callback(request.responseText);
      })
    }


  </script>
</body>

</html>
